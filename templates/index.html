<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>5G Flow Forensics — Demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root{
      --bg:#0f1724;
      --card:#ffffff;
      --muted:#6b7280;
      --accent:#0ea5a4;
      --accent-2:#7c3aed;
    }
    body{
      margin:0;
      font-family:Inter, Arial, sans-serif;
      background: linear-gradient(180deg, #071029 0%, #0f1724 100%);
      color:#e6eef8;
      padding:30px 16px;
    }
    .container{ max-width:980px; margin:0 auto; }
    header{ display:flex; align-items:center; gap:16px; margin-bottom:20px;}
    .logo{
      width:64px; height:64px; border-radius:12px;
      background: linear-gradient(135deg,var(--accent),var(--accent-2));
      display:flex; align-items:center; justify-content:center; font-weight:700; color:white;
      box-shadow: 0 6px 20px rgba(12,18,30,0.6);
    }
    h1{ margin:0; font-size:20px; }
    p.lead{ margin:4px 0 0; color:var(--muted); font-size:13px; }

    .grid{ display:grid; grid-template-columns: 1fr 420px; gap:20px; align-items:start; }
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
      border-radius:12px; padding:18px; box-shadow: 0 6px 30px rgba(2,6,23,0.6);
      color:#dbeafe;
    }

    form input, form button, form textarea{
      width:100%; padding:10px 12px; margin:8px 0; border-radius:8px; border:1px solid rgba(255,255,255,0.06);
      background:rgba(255,255,255,0.02); color:inherit; outline:none;
    }
    textarea { min-height:80px; resize:vertical; font-family:monospace; }
    label{ font-size:12px; color:var(--muted); display:block; margin-top:6px; }
    .muted{ color:var(--muted); font-size:13px; }

    .result-panel{
      background: linear-gradient(90deg, rgba(14,165,164,0.12), rgba(124,58,237,0.08));
      border-radius:8px; padding:12px; margin-top:10px;
    }
    .badge{
      display:inline-block; font-weight:600; padding:6px 10px; border-radius:999px; color:#062024;
      background:linear-gradient(90deg,var(--accent),var(--accent-2));
    }
    .correct-badge{ background: #10b981; color: #062020; padding:6px 10px; border-radius:8px; font-weight:700; }
    .wrong-badge{ background: #ef4444; color: #fff; padding:6px 10px; border-radius:8px; font-weight:700; }

    .tokens { margin-top:10px; }
    .token{ display:inline-block; background:rgba(255,255,255,0.03); padding:6px 8px; margin:4px; border-radius:8px; font-size:12px; color:#dbeafe; }

    .plot{ width:100%; border-radius:8px; margin-top:10px; }

    .report-btn{ margin-top:12px; display:inline-block; background:#111827; padding:10px 14px; border-radius:8px; color:#fff; text-decoration:none; }

    footer{ margin-top:24px; text-align:center; color:var(--muted); font-size:13px; }
    @media(max-width:900px){
      .grid{ grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo">5G</div>
      <div>
        <h1>5G Flow Forensics — Prototype</h1>
        <p class="lead">Enter a network flow and get a predicted attack type, probability score, token-level explanation and a downloadable forensics-style report.</p>
      </div>
    </header>

    <div class="grid">
      <div class="card">
        <form method="POST" enctype="multipart/form-data">
          <!-- <label>Paste raw flow (optional) — format: <em>srcip=... dstip=... protocol=... ... ,true_label (optional)</em></label>
          <textarea name="rawflow" placeholder="e.g. srcip=90.247.10.100 dstip=111.6.10.100 protocol=0 fwdpkts=2 bwdpkts=0 duration=30 fwdbytelen=0 bwdbytelen=0,benign">{{ rawflow }}</textarea> -->
          <label for="rawflow">Raw 5G Flow (text format):</label>
<textarea name="rawflow" rows="3">{{ rawflow }}</textarea>
<small>
Format: <code>
srcip=IP dstip=IP protocol=0/1 fwdpkts=# bwdpkts=# duration=# fwdbytelen=# bwdbytelen=#
</code>
</small>

          <div style="text-align:center; margin:6px 0; color:var(--muted);">— OR —</div>

          <label>Source IP</label>
          <input name="srcip" placeholder="e.g. 166.100.10.100" value="{{ srcip }}">
          <label>Destination IP</label>
          <input name="dstip" placeholder="e.g. 111.7.10.100" value="{{ dstip }}">
          <label>Protocol (numeric)</label>
          <input name="protocol" placeholder="e.g. 6" value="{{ protocol }}">
          <label>Forward Packets</label>
          <input name="fwdpkts" placeholder="e.g. 2" value="{{ fwdpkts }}">
          <label>Backward Packets</label>
          <input name="bwdpkts" placeholder="e.g. 0" value="{{ bwdpkts }}">
          <label>Duration</label>
          <input name="duration" placeholder="e.g. 2836" value="{{ duration }}">
          <label>Forward Bytes</label>
          <input name="fwdbytelen" placeholder="e.g. 0" value="{{ fwdbytelen }}">
          <label>Backward Bytes</label>
          <input name="bwdbytelen" placeholder="e.g. 0" value="{{ bwdbytelen }}">

          <!-- <label style="margin-top:10px;">(Optional) Upload CSV for timeline plot</label>
         <input type="file" name="testcsv" accept=".csv"> -->

          <button type="submit" style="margin-top:10px;">Run Prediction</button>
        </form>

        <div class="muted" style="margin-top:12px;">
          Note: Model and vectorizer must be present on the server (see README). Paste raw flow to bypass the form fields.
        </div>
      </div>

      <div class="card">
        <h3 style="margin:0">Prediction</h3>
        <div class="muted">Instant result & explanation</div>

        {% if result %}
        <div class="result-panel">
          <div style="display:flex; justify-content:space-between; align-items:center;">
            <div>
              <div style="font-size:16px; font-weight:700;">Predicted Label</div>
              <div style="margin-top:6px;"><span class="badge">{{ result.label }}</span></div>

              {% if result.true_label is defined %}
                <div style="margin-top:8px;">
                  <span class="{% if result.label == result.true_label %}correct-badge{% else %}wrong-badge{% endif %}">
                    True: {{ result.true_label }}
                  </span>
                </div>
              {% endif %}
            </div>
            <div style="text-align:right;">
              <div class="muted" style="font-size:12px;">Probability</div>
              {% if error %}
              <div class="alert alert-danger">{{ error }}</div>
              {% endif %}
              <div style="font-weight:700; font-size:18px;">{{ (result.prob*100) | round(2) }}%</div>
            </div>
          </div>

          <div style="margin-top:10px; font-size:13px;">
            <div class="muted">Flow (textified)</div>
            <div style="background:#031025; padding:8px; border-radius:8px; margin-top:6px; font-family:monospace; font-size:12px;">{{ result.flow_text }}</div>
          </div>

          {% if explanation and explanation|length>0 %}
          <div class="tokens">
            <div class="muted" style="margin-top:8px;">Top contributing tokens</div>
            {% for t in explanation %}
              <span class="token">{{ t.token }} (score: {{ '%.4f'|format(t.score) }})</span>
            {% endfor %}
          </div>
          {% endif %}

          <!-- {% if timeline_img %}
          <div style="margin-top:10px;">
            <div class="muted">Timeline for predicted label</div>
            <img src="{{ timeline_img }}" class="plot" alt="timeline">
          </div>
          {% endif %} -->
<!-- 
          {% if report_file %}
          <div style="margin-top:10px;">
             <a class="report-btn" href="/download_report/{{ report_file }}">Download Forensic Report (HTML)</a>
          </div>
          {% endif %} -->
        </div>
        {% else %}
        <div style="margin-top:16px;" class="muted">No prediction yet. Paste a raw flow or fill the form and click <strong>Run Prediction</strong>.</div>
        {% endif %}
      </div>
    </div>

    <footer>
      Prototype — 5G Flow Forensics · TF-IDF + Logistic Regression · Local demo
    </footer>
  </div>
</body>
</html>
